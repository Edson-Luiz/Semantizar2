<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualização - Semantizar 2.0</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2"></script>
</head>
<body>
  <header>
    <div class="inner">
        <div class="logo">
            <a href="/">
                <img class="logo2semantizar" src="{{ url_for('static', filename='img/semantizar2logo3.png') }}" alt="Logo do Semantizar 2.0 com um ícone representando análise de texto">
            </a>
        </div>
        <nav>
            <ul>
                <li><a href="/">Página inicial</a></li>
                <li><a href="sobre">Sobre</a></li>
                <li><a href="contato">Contato</a></li>
            </ul>
        </nav>
    </div>
</header>
<div class="indicador-pagina">
  <p><a href="/">Página inicial</a> / <a href="cadastro">Cadastro</a> / <a href="cadastroTermos">Cadastro termos</a> / <a href="validacaoRelacao">Validação das relações</a> / Visualizações das relações</p>
</div>
<h1>Visualização das Relações</h1>

<div class="container">
    <div style="display: flex; justify-content: center;">
    <img class="linhacadastro" src="{{ url_for('static', filename='img/linhadecadastrosemantizar4.png') }}" alt="linha de cadastro do sistema Semantizar 2.0">
    </div>
    <h2>Relações Extraídas</h2>
    <table border="1">
        <thead>
            <tr>
                <th>Termo 1</th>
                <th>Predicado</th>
                <th>Termo 2</th>
            </tr>
        </thead>
        <tbody id="relations-table">
        </tbody>
    </table><br>
    <h2>Frequência de Termos</h2>
    <canvas id="chart"></canvas><br>
    <h2>Distribuição de Relações (Gráfico de Pizza)</h2>
    <canvas id="pie-chart"></canvas><br>
    <h2>Nuvem de Palavras</h2>
    <canvas id="wordcloud"></canvas><br>
</div>

<footer>
    <p>&copy; 2025 Semantizar 2.0. Todos os direitos reservados.</p>
</footer>
<script>
    async function carregarRelacoes() {
        try {
            const response = await fetch("/get_relacoes");
            const data = await response.json();

            if (!data || data.erro) {
                alert("Erro ao carregar as relações!");
                return;
            }

            const tableBody = document.getElementById("relations-table");
            tableBody.innerHTML = '';

            let termoFreq = {};
            let predicadoFreq = {};

            data.forEach(relacao => {
                const row = tableBody.insertRow();
                row.insertCell(0).textContent = relacao.termo1;
                row.insertCell(1).textContent = relacao.predicado;
                row.insertCell(2).textContent = relacao.termo2;

                termoFreq[relacao.termo1] = (termoFreq[relacao.termo1] || 0) + 1;
                termoFreq[relacao.termo2] = (termoFreq[relacao.termo2] || 0) + 1;
                predicadoFreq[relacao.predicado] = (predicadoFreq[relacao.predicado] || 0) + 1;
            });

            criarGraficoBarras(termoFreq);
            criarGraficoPizza(predicadoFreq);
            criarNuvemPalavras(termoFreq);
        } catch (error) {
            console.error("Erro ao carregar as relações:", error);
            alert("Houve um erro ao carregar as relações.");
        }
    }

    function criarGraficoBarras(dados) {
        new Chart(document.getElementById("chart"), {
            type: 'bar',
            data: {
                labels: Object.keys(dados),
                datasets: [{
                    label: "Frequência de Termos",
                    data: Object.values(dados),
                    backgroundColor: "rgba(75, 192, 192, 0.2)",
                    borderColor: "rgba(75, 192, 192, 1)",
                    borderWidth: 1
                }]
            }
        });
    }

    function criarGraficoPizza(dados) {
        new Chart(document.getElementById("pie-chart"), {
            type: 'pie',
            data: {
                labels: Object.keys(dados),
                datasets: [{
                    data: Object.values(dados),
                    backgroundColor: ["#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF"]
                }]
            }
        });
    }

    function criarNuvemPalavras(dados) {
        const canvas = document.getElementById("wordcloud");
        const ctx = canvas.getContext("2d");
        const words = Object.keys(dados).map(word => ({ text: word, size: 10 + dados[word] * 5 }));
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        WordCloud(canvas, { list: words.map(w => [w.text, w.size]), gridSize: 10, weightFactor: 2 });
    }

    window.onload = carregarRelacoes;
</script>
</body>
</html>
